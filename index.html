<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
  <title>Gauss–Seidel Solver</title>
  <style>
    :root {
      --accent: #2563eb;
      --accent-light: #60a5fa;
      --accent-dark: #1d4ed8;
      --muted: #64748b;
      --bg: #f1f5f9;
      --card: #ffffff;
      --border: #e2e8f0;
      --radius: 12px;
      --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
      --transition: all 0.2s ease;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    }
    body{
      margin: 0;
      background: var(--bg);
      color: #0f172a;
      padding: 16px;
      -webkit-font-smoothing: antialiased;
      line-height: 1.5;
    }
    @media (min-width: 768px) {
      body {
        padding: 28px;
      }
    }
    .wrap{
      max-width: 980px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 1fr;
      gap: 20px;
      align-items: start;
    }
    @media (min-width: 768px) {
      .wrap {
        grid-template-columns: 1fr 380px;
      }
    }
    header{
      grid-column: 1 / -1;
      margin-bottom: 6px;
    }
    h1{ margin: 0 0 6px 0; font-size: 20px; }
    p.lead{ margin:0; color:var(--muted); font-size: 13px; }

    .card{
      background: var(--card);
      border-radius: var(--radius);
      padding: 24px;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
      transition: var(--transition);
    }
    .card:hover {
      box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
    }

    .controls{
      display: flex;
      flex-direction: column;
      gap: 16px;
      align-items: stretch;
      margin-bottom: 20px;
    }
    @media (min-width: 768px) {
      .controls {
        flex-direction: row;
        align-items: flex-end;
      }
    }

    label { 
      font-size: 13px; 
      display: block; 
      margin-bottom: 8px; 
      color: var(--muted);
      font-weight: 500;
    }
    input[type="number"], input[type="text"], select {
      width: 100%;
      box-sizing: border-box;
      padding: 10px 12px;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      font-size: 14px;
      outline: none;
      transition: var(--transition);
      background: #fff;
    }
    input[type="number"]:hover, input[type="text"]:hover, select:hover {
      border-color: var(--accent-light);
    }
    input[type="number"]:focus, input[type="text"]:focus, select:focus { 
      border-color: var(--accent); 
      box-shadow: 0 0 0 4px rgba(37,99,235,0.1);
    }

    button {
      background: var(--accent);
      color: #fff;
      border: none;
      padding: 10px 16px;
      border-radius: var(--radius);
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    button:hover {
      background: var(--accent-dark);
      transform: translateY(-1px);
    }
    button:active {
      transform: translateY(0);
    }
    button.secondary {
      background: transparent;
      color: var(--accent);
      border: 1px solid var(--border);
    }
    button.secondary:hover {
      background: var(--bg);
      color: var(--accent-dark);
      border-color: var(--accent-light);
    }
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .matrix-grid {
      display: grid;
      gap: 8px;
      margin-bottom: 20px;
      padding: 12px;
      background: var(--bg);
      border-radius: var(--radius);
      border: 1px solid var(--border);
      position: relative;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: thin;
      max-width: 100%;
    }
    @media (min-width: 768px) {
      .matrix-grid {
        gap: 16px;
        padding: 24px;
      }
    }

    .matrix-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(40px, 1fr));
      gap: 4px;
      position: relative;
      justify-content: start;
      height: 40px;
      align-items: center;
      width: 100%;
      min-width: 0;
    }
    @media (min-width: 768px) {
      .matrix-row {
        gap: 16px;
        grid-template-columns: repeat(3, minmax(64px, 64px));
      }
    }
    
    /* System equation styling */
    .matrix-grid > div {
      display: flex;
      gap: 24px;
      align-items: flex-start;
      width: 100%;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      padding-bottom: 8px;
    }
    @media (min-width: 768px) {
      .matrix-grid > div {
        gap: 48px;
        overflow-x: visible;
      }
    }
    
    /* Vector b styling */
    .matrix-grid > div > div:last-child {
      position: relative;
      padding-left: 24px;
      flex-shrink: 0;
    }
    @media (min-width: 768px) {
      .matrix-grid > div > div:last-child {
        padding-left: 48px;
      }
    }

    .vector-b {
      display: grid;
      gap: 16px;
      position: relative;
    }
    
    .vector-b input {
      margin-top: 0 !important;
      margin-bottom: 0 !important;
    }

    /* Ensure consistent row heights for both matrix and vector */
    .matrix-grid .matrix-row,
    .vector-b > input {
      height: 40px;
      margin: 0;
    }

    /* Fix vertical alignment of all inputs */
    .matrix-grid input,
    .vector-b input {
      margin: 0;
      height: 40px !important;
      line-height: 40px;
      padding: 0 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      min-width: 0;
      font-size: 13px;
    }
    @media (min-width: 768px) {
      .matrix-grid input,
      .vector-b input {
        padding: 0 8px;
        font-size: 14px;
      }
    }
    
    .vector-b::before {
      content: '';
      position: absolute;
      left: -48px;
      top: 50%;
      width: 48px;
      height: 2px;
      background: var(--accent-light);
      opacity: 0.3;
      transform: translateY(-50%);
    }

    .matrix-grid input, .vector-b input {
      width: 64px;
      height: 40px !important;
      box-sizing: border-box;
      text-align: center;
      font-family: 'SF Mono', Consolas, monospace;
      font-size: 14px;
      margin: 0;
    }
    
    .matrix-grid input {
      width: 64px;
      height: 40px;
      box-sizing: border-box;
      font-family: 'SF Mono', Consolas, monospace;
      font-size: 14px;
      text-align: center;
      padding: 8px;
    }
    
    .matrix-grid > div > div:last-child::before {
      content: '';
      position: absolute;
      left: 0;
      top: 50%;
      width: 24px;
      height: 2px;
      background: var(--accent-light);
      opacity: 0.3;
      transform: translateY(-50%);
    }

    .matrix-row input {
      text-align: center;
      font-family: "SF Mono", Consolas, Monaco, monospace;
      transition: var(--transition);
    }
    
    .matrix-row input:focus {
      transform: scale(1.05);
      z-index: 1;
    }

    /* Matrix bracket styling */
    .matrix-grid .matrix-grid {
      position: relative;
      padding: 8px 24px;
    }
    
    .matrix-grid .matrix-grid::before,
    .matrix-grid .matrix-grid::after {
      content: '';
      position: absolute;
      width: 2px;
      top: 0;
      height: 100%;
      background: var(--accent);
      opacity: 0.3;
    }
    
    .matrix-grid .matrix-grid::before {
      left: 0;
    }
    
    .matrix-grid .matrix-grid::after {
      right: 0;
    }
    
    .matrix-grid .matrix-grid::before,
    .matrix-grid .matrix-grid::after {
      content: '';
      position: absolute;
      width: 8px;
      height: 2px;
      background: var(--accent);
      opacity: 0.3;
    }
    
    .matrix-grid .matrix-grid::before {
      top: 0;
      left: 0;
      border-radius: 2px 0 0 0;
    }
    
    .matrix-grid .matrix-grid::after {
      bottom: 0;
      right: 0;
      border-radius: 0 0 2px 0;
    }

    .small{ font-size: 12px; color: var(--muted); }

    .right-panel { position: sticky; top: 20px; align-self: start; }

    pre { 
      background: #111; 
      color: #eee; 
      padding: 12px; 
      border-radius: 8px; 
      overflow: auto; 
      max-height: 360px;
      font-size: 13px;
      line-height: 1.4;
      white-space: pre-wrap;
      word-break: break-word;
    }
    @media (max-width: 480px) {
      pre {
        padding: 8px;
        font-size: 11px;
        max-height: 200px;
      }
    }
    table { 
      width: 100%; 
      border-collapse: collapse; 
      margin-top: 8px; 
      font-size: 13px;
      min-width: 200px;
    }
    th, td { 
      padding: 8px; 
      border: 1px solid #eee; 
      text-align: right; 
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 120px;
    }
    th { 
      background: #fafafa; 
      font-weight: 700; 
      color: #333; 
      text-align: center;
    }
    @media (max-width: 480px) {
      table {
        font-size: 12px;
      }
      th, td {
        padding: 6px;
      }
    }

    .warning { background: #fff4e6; border-left: 4px solid #ffb84d; padding:8px; border-radius:8px; font-size:13px; color:#6a4b00; margin-bottom:10px; }

    .loading {
      position: relative;
      pointer-events: none;
    }
    .loading::after {
      content: '';
      position: absolute;
      inset: 0;
      background: rgba(255,255,255,0.8);
      border-radius: inherit;
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
    @keyframes pulse {
      0%, 100% { opacity: 0.8; }
      50% { opacity: 0.5; }
    }

    .success-animation {
      animation: success-fade 1s ease;
    }
    @keyframes success-fade {
      0% { background: rgba(34,197,94,0.1); }
      100% { background: transparent; }
    }

    .footer-note { grid-column: 1 / -1; margin-top: 14px; color: var(--muted); font-size: 13px; text-align:center; }
    @media (max-width:980px){
      .wrap { 
        grid-template-columns: 1fr; 
        padding: 12px;
        gap: 16px;
      }
      .right-panel { 
        position: relative; 
        top: auto;
      }
      .controls { 
        flex-direction: column; 
        align-items: stretch;
        gap: 20px;
      }
      .controls > div { 
        width: 100% !important;
      }
      .matrix-row {
        overflow-x: auto;
        padding-bottom: 4px;
      }
      .matrix-row input {
        min-width: 60px;
        flex-shrink: 0;
      }
      button {
        width: 100%;
        justify-content: center;
      }
      pre {
        font-size: 13px;
        max-height: 200px;
      }
    }
    
    @media (max-width:480px) {
      body {
        padding: 8px;
      }
      .card {
        padding: 12px;
      }
      h1 {
        font-size: 18px;
      }
      .matrix-grid {
        padding: 8px;
        gap: 6px;
      }
      .matrix-row {
        gap: 4px;
      }
      .matrix-grid input, .vector-b input {
        font-size: 11px;
        height: 32px !important;
        line-height: 32px;
        padding: 0 2px;
      }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Gauss–Seidel Solver </h1>
      <p class="lead">Enter matrix A and vector b, set initial guess, tolerance and max iterations. Click <strong>Run</strong> to start.</p>
    </header>

    <section class="card">
      <div class="controls">
        <div style="width:150px">
          <label>System size (n)</label>
          <select id="size">
            <option value="2">2</option>
            <option value="3" selected>3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
          </select>
        </div>

        <div style="width:120px">
          <label>Tolerance</label>
          <input type="number" id="tol" value="1e-6" step="any" />
        </div>

        <div style="width:140px">
          <label>Max iterations</label>
          <input type="number" id="maxiter" value="10" />
        </div>
      </div>

      <div style="display:flex; gap:12px; margin-bottom:12px;">
        <button id="build">Build matrix</button>
        <button id="fill-sample" class="secondary">Load sample</button>
        <button id="run" style="margin-left:auto">Run Gauss–Seidel</button>
      </div>

      <div id="warn-area"></div>

      <div id="matrix-area" class="matrix-grid"></div>

      <div class="controls">
        <div>
          <label>Initial guess (comma-separated)</label>
          <input id="x0" type="text" placeholder="e.g. 0,0,0" style="width: 100%" />
        </div>

        <div>
          <label>Display every</label>
          <input id="display-every" type="number" value="1" min="1" style="width: 100%" />
          <div class="small">Show log every k iterations</div>
        </div>
      </div>

      <div style="margin-top:12px;">
        <div class="small">Iteration log</div>
        <pre id="log" style="height:220px;">No runs yet.</pre>
      </div>
    </section>

    <aside class="card right-panel">
      <div style="display:flex; gap:8px; align-items:center; margin-bottom:10px; flex-wrap: wrap;">
        <h3 style="margin:0; font-size:16px;">Result</h3>
        <div style="flex:1"></div>
      </div>

      <div id="result-area">
        <div class="small">Solution vector x</div>
        <table id="result-table" style="margin-top:8px;">
          <thead><tr><th>i</th><th>x_i</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>

      <div style="margin-top:12px;">
        <div class="small">Notes</div>
        <ul style="padding-left:18px; margin:8px 0 0 0; color:var(--muted); font-size:13px;">
          <li>Method requires A's diagonal entries nonzero.</li>
          <li>Better convergence if matrix is diagonally dominant.</li>
        </ul>
      </div>
    </aside>

    <div class="footer-note">Implementation uses the standard Gauss–Seidel update x_i = (b_i - Σ_{j≠i} a_{ij} x_j)/a_{ii}.</div>
  </div>

<script>
  // Utilities
  const qs = s => document.querySelector(s);
  const qsa = s => Array.from(document.querySelectorAll(s));

  function buildMatrixUI(n) {
  const container = qs('#matrix-area');
  container.innerHTML = '';
  container.style.gridTemplateColumns = '1fr';

  const Abox = document.createElement('div');
//   Abox.innerHTML = '<label>Augmented Matrix [A | b]</label>';
  const grid = document.createElement('div');
  grid.className = 'matrix-grid matrix-wrapper';

  for (let i = 0; i < n; i++) {
    const row = document.createElement('div');
    row.className = 'matrix-row';
    row.style.gridTemplateColumns = `repeat(${n + 1}, minmax(40px, 1fr))`; // add 1 column for b

    for (let j = 0; j < n; j++) {
      const inp = document.createElement('input');
      inp.type = 'number';
      inp.step = 'any';
      inp.value = (i === j) ? '4' : ((Math.abs(i - j) === 1) ? '-1' : '0'); // default sample
      inp.dataset.r = i; inp.dataset.c = j;
      row.appendChild(inp);
    }

    // now append b column input
    const inpB = document.createElement('input');
    inpB.type = 'number';
    inpB.step = 'any';
    inpB.value = (i + 1).toString(); // default b values
    inpB.dataset.b = i;
    row.appendChild(inpB);

    grid.appendChild(row);
  }

  Abox.appendChild(grid);
  container.appendChild(Abox);

  // fill initial guess placeholder
  qs('#x0').value = Array(n).fill('0').join(',');
}

  function readMatrix(n) {
    const A = Array.from({length:n},()=>Array(n).fill(0));
    for (const inp of qsa('#matrix-area input')) {
      if (inp.dataset.r !== undefined) {
        const r = +inp.dataset.r, c = +inp.dataset.c;
        const v = Number(inp.value);
        if (isNaN(v)) throw new Error('Invalid A entry');
        A[r][c] = v;
      }
    }
    const b = Array(n).fill(0);
    for (const inp of qsa('#matrix-area input')) {
      if (inp.dataset.b !== undefined) {
        const i = +inp.dataset.b;
        const v = Number(inp.value);
        if (isNaN(v)) throw new Error('Invalid b entry');
        b[i] = v;
      }
    }
    return {A,b};
  }

  function isDiagonallyDominant(A) {
    for (let i=0;i<A.length;i++){
      const diag = Math.abs(A[i][i]);
      let others = 0;
      for (let j=0;j<A.length;j++) if (j!==i) others += Math.abs(A[i][j]);
      if (diag < others) return false;
    }
    return true;
  }

  function gaussSeidel(A, b, x0, tol=1e-6, maxIter=10, displayEvery=1, logger=(s)=>{}) {
    const n = b.length;
    let x = x0.slice();
    let converged = false;
    logger(`Starting Gauss–Seidel, n=${n}, tol=${tol}, maxIter=${maxIter}`);
    for (let k=1;k<=maxIter;k++){
      const x_old = x.slice();
      for (let i=0;i<n;i++){
        let sigma = 0;
        for (let j=0;j<n;j++){
          if (j!==i) sigma += A[i][j] * x[j];
        }
        if (A[i][i] === 0) throw new Error(`Zero diagonal element at row ${i+1}`);
        x[i] = (b[i] - sigma) / A[i][i];
      }
      const diff = maxAbs(diffVec(x,x_old));
      if (k % displayEvery === 0) {
        logger(`Iter ${k}: x = [${x.map(v=>numStr(v)).join(', ')}], ||Δ||_∞ = ${numStr(diff)}`);
      }
      if (diff < tol) {
        logger(`Converged in ${k} iterations. ||Δ||_∞ = ${numStr(diff)}`);
        converged = true;
        return {x, iterations:k, converged};
      }
    }
    logger('Reached max iterations without full convergence.');
    return {x, iterations: maxIter, converged};
  }

  function numStr(v){ return Number.parseFloat(v).toPrecision(6); }
  function diffVec(a,b){ return a.map((v,i)=>v - b[i]); }
  function maxAbs(v){ return Math.max(...v.map(x=>Math.abs(x))); }

  // DOM hooks
  document.addEventListener('DOMContentLoaded', ()=>{
    const sizeSel = qs('#size');
    buildMatrixUI(+sizeSel.value);

    qs('#build').addEventListener('click', ()=> buildMatrixUI(+sizeSel.value));
    sizeSel.addEventListener('change', ()=> buildMatrixUI(+sizeSel.value));

    qs('#fill-sample').addEventListener('click', ()=>{
      // fill a helpful sample 3x3
      sizeSel.value = 3;
      buildMatrixUI(3);
      // sample A and b
      const valsA = [ [4,-1,0], [-1,4,-1], [0,-1,4] ];
      const valsB = [3,4,5];
      for (const inp of qsa('#matrix-area input')){
        if (inp.dataset.r !== undefined){
          inp.value = valsA[+inp.dataset.r][+inp.dataset.c];
        } else if (inp.dataset.b !== undefined) {
          inp.value = valsB[+inp.dataset.b];
        }
      }
      qs('#x0').value = '0,0,0';
    });

    qs('#run').addEventListener('click', async (e)=>{
      const btn = e.target;
      const card = qs('.card');
      const n = +qs('#size').value;
      const log = qs('#log'); log.textContent = '';
      const warn = qs('#warn-area'); warn.innerHTML = '';
      const displayEvery = Math.max(1, Math.trunc(Number(qs('#display-every').value) || 1));
      
      // Add loading state
      btn.disabled = true;
      card.classList.add('loading');
      try {
        const {A,b} = readMatrix(n);
        const tol = Number(qs('#tol').value) || 1e-6;
        const maxIter = Math.max(1, Math.trunc(Number(qs('#maxiter').value) || 10));
        let x0raw = qs('#x0').value.trim();
        let x0 = x0raw ? x0raw.split(',').map(s=>Number(s.trim())) : Array(n).fill(0);
        if (x0.length !== n) throw new Error('Initial guess vector length mismatch');

        if (!isDiagonallyDominant(A)) {
          warn.innerHTML = '<div class="warning">Matrix A is not strictly diagonally dominant — the method may not converge.</div>';
        }

        const logger = (s)=>{ log.textContent += s + "\n"; log.scrollTop = log.scrollHeight; };
        const result = gaussSeidel(A,b,x0,tol,maxIter,displayEvery,logger);

        // show final solution
        const tbody = qs('#result-table tbody');
        tbody.innerHTML = '';
        for (let i=0;i<n;i++){
          const tr = document.createElement('tr');
          tr.innerHTML = `<td style="text-align:center">${i+1}</td><td>${Number(result.x[i]).toPrecision(8)}</td>`;
          tbody.appendChild(tr);
        }
        if (!result.converged) {
          logger(`Final ||Δ||_∞ >= tol after ${result.iterations} iterations.`);
        }
      } catch (err) {
        qs('#log').textContent = 'Error: ' + err.message;
      } finally {
        // Remove loading state
        const btn = qs('#run');
        const card = qs('.card');
        btn.disabled = false;
        card.classList.remove('loading');
        
        // Add success animation if no error
        if (!qs('#log').textContent.includes('Error')) {
          qs('#result-table').classList.add('success-animation');
          setTimeout(() => {
            qs('#result-table').classList.remove('success-animation');
          }, 1000);
        }
      }
    });

  });
</script>
</body>
</html>

